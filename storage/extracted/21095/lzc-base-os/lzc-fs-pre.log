+ true
+ cd /run/lzcsys/boot/lzc-base-os-init
+ for component in vendor rootfs hportal daemon config
++ readlink vendor.erofs
+ component_cur=vendor/vendor-v0.1.52.erofs
+ find vendor -mindepth 1 -not -path vendor/vendor-v0.1.52.erofs -delete
+ for component in vendor rootfs hportal daemon config
++ readlink rootfs.erofs
+ component_cur=rootfs/rootfs-v0.1.52.erofs
+ find rootfs -mindepth 1 -not -path rootfs/rootfs-v0.1.52.erofs -delete
+ for component in vendor rootfs hportal daemon config
++ readlink hportal.erofs
+ component_cur=hportal/hportal-v0.15.4-2-1-gb37603d8.erofs
+ find hportal -mindepth 1 -not -path hportal/hportal-v0.15.4-2-1-gb37603d8.erofs -delete
+ for component in vendor rootfs hportal daemon config
++ readlink daemon.erofs
+ component_cur=daemon/daemon-v0.0.1-168-g46e0ba19.erofs
+ find daemon -mindepth 1 -not -path daemon/daemon-v0.0.1-168-g46e0ba19.erofs -delete
+ for component in vendor rootfs hportal daemon config
++ readlink config.erofs
+ component_cur=config/config-v0.1.52.erofs
+ find config -mindepth 1 -not -path config/config-v0.1.52.erofs -delete
+ sync
++ cat /sys/class/dmi/id/sys_vendor
+ sys_vendor=INTEL
+ '[' INTEL == QEMU ']'
+ '[' '!' -f /lzcsys/etc/debug.env ']'
+ touch /lzcsys/etc/debug.env
+ '[' '!' -f /lzcsys/etc/box.data.path ']'
++ stat -c %s,%a /etc/machine-id
+ '[' '!' 33,444 == 33,444 ']'
+ mountpoint -q /sys/firmware/efi/efivars
+ mount -t efivarfs -o rw,nosuid,nodev,noexec,relatime none /sys/firmware/efi/efivars
+ mkdir -p /lzcsys/run/machine
+ '[' -f /lzcsys/etc/machine.bsid ']'
+ install -Dm644 /lzcsys/etc/machine.bsid /lzcsys/run/machine/bsid
++ cat /lzcsys/run/machine/bsid
+ bsid=0100067e7a00005204PA3Fc2rV
+ '[' '!' -f /lzcsys/run/machine/bsid ']'
+ '[' '!' -f /sys/firmware/efi/efivars/machine.bsid-66506d98-dce8-4f98-be65-10c260b3fa0f ']'
+ '[' -f /lzcsys/run/machine/bsid ']'
++ cat /lzcsys/run/machine/bsid
+ bsid=0100067e7a00005204PA3Fc2rV
+ pincode=PA3Fc2rV
+ echo PA3Fc2rV
++ printf %s PA3Fc2rV
++ sha256sum
++ cut -c-8
+ pincode_sha256_8=60378f6b
+ device_name=lzcbox-60378f6b
+ echo lzcbox-60378f6b
+ /lzcsys/sbin/wifip2p.sh install
+ '[' '!' -f /etc/ssh/ssh_host_ed25519_key ']'
+ '[' '!' -f /run/lzcsys/boot/lzc-base-os-init/machine/etc/ssh/ssh_host_ed25519_key ']'
+ source /lzcsys/etc/debug.env
+ '[' '' '!=' 1 ']'
+ '[' '' '!=' 1 ']'
+ rm /etc/systemd/system/multi-user.target.wants/ssh.service
+ rm /etc/systemd/system/sshd.service
+ '[' '' == 1 ']'
+ '[' '' == 1 ']'
+ mkdir -p /run/lzcsys/boot/lzc-base-os-init/var/log
+ mount --bind /run/lzcsys/boot/lzc-base-os-init/var/log /var/log
+ '[' '' == 1 ']'
+ '[' '' == 1 ']'
+ '[' '!' '' ']'
+ VAR_IMG_SIZE_MB=512
+ VAR_IMG_SIZE=536870912
+ mkdir -p /run/lzcsys/var
+ '[' '!' -f /run/lzcsys/boot/lzc-base-os-init/var.img ']'
++ perl -le 'use POSIX;print floor(log($ARGV[0])/log(2));' 536870912
+ new_log2=29
++ stat -c %s /run/lzcsys/boot/lzc-base-os-init/var.img
+ old_size=536870912
++ perl -le 'use POSIX;print floor(log($ARGV[0])/log(2));' 536870912
+ old_log2=29
+ '[' 29 -eq 29 ']'
+ e2fsck -f -y /run/lzcsys/boot/lzc-base-os-init/var.img
e2fsck 1.47.2-rc1 (28-Nov-2024)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/run/lzcsys/boot/lzc-base-os-init/var.img: 93/32768 files (41.9% non-contiguous), 71882/131072 blocks
+ resize2fs /run/lzcsys/boot/lzc-base-os-init/var.img
resize2fs 1.47.2-rc1 (28-Nov-2024)
The filesystem is already 131072 (4k) blocks long.  Nothing to do!

+ mount -t ext4 -o rw,noatime,loop /run/lzcsys/boot/lzc-base-os-init/var.img /run/lzcsys/var
+ mkdir -p /run/lzcsys/var/NetworkManager/system-connections /run/lzcsys/var/journal /run/lzcsys/var/hportal
+ mkdir -p /etc/NetworkManager/system-connections /var/log/journal /lzcsys/etc/hportal-server
+ mount --bind /run/lzcsys/var/NetworkManager/system-connections /etc/NetworkManager/system-connections
+ mount --bind /run/lzcsys/var/journal /var/log/journal
+ '[' -d /lzcsys/run/qemu-volume ']'
+ mount --bind /run/lzcsys/var/hportal /lzcsys/etc/hportal-server
+ echo 'mount update tool ...'
mount update tool ...
+ /lzcsys/sbin/lzc-os.sh mount_update_tool
+ package_suffixes=(['tar']='tar xf "$package" -C /mnt' ['tar.gz']='gzip -cd "$package" | tar xf - -C /mnt' ['tar.xz']='xz -cd "$package" | tar xf - -C /mnt' ['tar.bz2']='bzip2 -cd "$package" | tar xf - -C /mnt' ['tar.lz4']='lz4 -cd "$package" | tar xf - -C /mnt' ['tar.zstd']='tar xf "$package" -C /mnt' ['tar.zst']='tar xf "$package" -C /mnt' ['zip']='unzip -d /mnt "$package"')
+ declare -A package_suffixes
+ main mount_update_tool
+ local cmd=mount_update_tool
+ shift
+ '[' mount_update_tool == '' ']'
+ '[' mount_update_tool == -h ']'
+ '[' mount_update_tool == --help ']'
+ type cmd_mount_update_tool
+ cmd_mount_update_tool
+ mkdir -p /run/lzcsys/boot/update-bundle/update-tool
+ mountpoint -q /run/lzcsys/boot/update-bundle/update-tool
+ mount -t erofs -o loop /run/lzcsys/boot/lzc-base-os-init/update-tool.erofs /run/lzcsys/boot/update-bundle/update-tool
+ dmesg --console-off

real	0m0.003s
user	0m0.002s
sys	0m0.001s
